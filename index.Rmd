---
title: "Pajareadas en Caldas y Quindio"
author: "Sandra Rair√°n"
output: 
  flexdashboard::flex_dashboard:
    orientation: row
    social: menu
    source_code: embed
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(dplyr)
library(tidyr)
library(RColorBrewer)
library(tidyverse)
library(lubridate)
library(janitor)
library(vroom)
#library(broom)
#library(hrbrthemes)

#------------------ Parameters ------------------
# Set colors
# https://www.w3.org/TR/css-color-3/#svg-color
count_color <- "mediumvioletred"
active_color <- "orange"
recovered_color <- "forestgreen"
Durationmin_color <- "teal"

MyEBirdData<- read.csv("data/MyEBirdData.csv")
#data(MyEBirdData)
#str(MyEBirdData1)

#------------------ Data ------------------

#df1 <- MyEBirdData1 %>% dplyr::filter(Date == max(Date))

df_count <- MyEBirdData %>%  
  dplyr::group_by(Submission.ID, Date) %>%
  dplyr::mutate(count_cum = sum(MyEBirdData$Duration..Min))
                
bird_cantidad <- MyEBirdData %>% group_by( MyEBirdData$Submission.ID, MyEBirdData$Date )
birdcantidad <- bird_cantidad  %>% summarise(n = n())

# Minutos obervados por id de pajareo
bird_duracion_minuto <- MyEBirdData %>% group_by( MyEBirdData$Submission.ID, MyEBirdData$Date, MyEBirdData$Duration..Min.  )
birdduracionminuto <- bird_duracion_minuto  %>% summarise(n = n())

df <- MyEBirdData %>% 
mutate_at(vars(Submission.ID, Location, Date, Time, Protocol), str_replace_na, "NA") %>% 
  mutate(observation_event_id = str_c(Submission.ID, Location, Date, Time, sep = "-"),
         observation_date = ymd(Date)) 

#Cantidad por protocolo estacionario o con desplaazamiento
df_top_protocols <- df %>% 
  count(Protocol, sort = TRUE) %>% 
  slice(1:2)

df <- df %>% 
  semi_join(df_top_protocols) 

df %>% 
  select(Common.Name, Date, Count) %>% 
  glimpse()
         
```


Resumen
=======================================================================


Row {data-width=450}
-----------------------------------------------------------------------

### Count {.value-box}

```{r}



valueBox(
  value = paste(format(sum(birdcantidad$n ), big.mark = ","), "", sep = " "),
  caption = "Total de Aves Observadas",
  icon = "far fa-smile",
  color = count_color
)


```




### Duration..Min. {.value-box}
```{r}

valueBox(
  value = paste(format(sum(birdduracionminuto$`MyEBirdData$Duration..Min.` ), big.mark = ","), "", sep = " "),
  caption = "Total Minutos Pajareando",
  icon = "far fa-smile",
  color = Durationmin_color
)

```

Row {data-height=600}
------------------------------------------------------------------------------
### Aves observadas segun el Duration..Min.
    
```{r}
library(tidyverse)
#Color al histograma
ggplot()+geom_histogram(data=MyEBirdData,
                        aes(x=Duration..Min.),fill="yellow",color="blue",
                        binwidth = 20)+
  labs(x="Tiempo observacion aves-minutos", y="Cantidad de Aves",
       title = "aves observadas segun el tiempo en minutos")+
  theme(legend.position = "none")+
  theme(panel.background = element_blank(),panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())
 

  

```



### Aves observadas segun el tiempo en minutos

```{r}




  plotly::plot_ly(data = MyEBirdData) %>%
  plotly::add_trace(x = ~ MyEBirdData$Duration..Min,
                    y = ~ MyEBirdData$Count,
                    type = "bar", 
                name = "Active",
                marker = list(color = active_color)) %>%
  plotly::layout(barmode = 'stack',
                 yaxis = list(title = "Cantidad de Aves",
                              type = "log"),
                 xaxis = list(title = "Duracion observacion en Minutos"),
                 hovermode = "compare",
                  margin =  list(
                   # l = 60,
                   # r = 40,
                   b = 10,
                   t = 10,
                   pad = 2
                 ))


```

Graficas
=======================================================================


```{r}
     
df %>% 
  count(observation_date) %>% 
  ggplot(aes(x = observation_date)) +
  geom_line(aes(y = n), colour = "maroon", group = 1) +
  #ggplot(aes(x=Date, y=n, group = 1, xlim=c(2019)))  +
   # geom_line() +
    labs(x = "Fecha Observacion",
         y = "Cantidad")+
   theme_light()


                         
```

Graficas
=======================================================================

Row {data-height=600}
-----------------------------------------------------------------------

### a

```{r}


```


### EDA con dataset proyecto - box plot- ggplot2 - dplyr
-----------------------------------------------------------------------
```{r}

Promedioaves <- mean(MyEBirdData$Count)
#Promedioaves
MyEBirdData<- MyEBirdData %>%
  mutate(Grande_Candidad_Aves = ifelse(Count < Promedioaves,
                                 "Por debajo del promedio aves observadas",
                                 "Sobre-Arriba del promedio aves observadas"))



ggplot(MyEBirdData, aes(x=Grande_Candidad_Aves , y=Duration..Min.,
                     fill=Grande_Candidad_Aves ))+
geom_boxplot(alpha=0.4)+
  labs(x="Grande_Candidad_Aves", y="Duration..Min.",
       title="Cantidad de aves Observadas en un Tiempo")+
  theme(legend.position = "none")+
  theme(panel.background = element_blank(),panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())

```

.
=======================================================================
Row {data-height=600}
------------------------------------------------------------------------------
### A
```{r}

```

